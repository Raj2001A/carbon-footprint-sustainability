<header class="app-header">
  <div class="brand">
    <img src="logo.png" alt="Carbon Footprint Tracker Logo" class="logo">
    <span>Carbon Footprint Tracker</span>
  </div>
  <nav class="nav-links">
    <a routerLink="/dashboard" routerLinkActive="active">Dashboard</a>
    <a routerLink="/add" routerLinkActive="active">Add Emission</a>
    <a routerLink="/emissions" routerLinkActive="active">Emissions</a>
    <a routerLink="/chart" routerLinkActive="active">Chart</a>
  </nav>
</header>

<main class="page">
  <section class="page-header">
    <h1>Add Emission</h1>
    <p class="muted">Record a new activity to track its carbon footprint.</p>
  </section>

  <section class="layout">
    <form [formGroup]="form" (ngSubmit)="submit()" class="form-card">
      <div class="field">
        <label for="category">Category<span class="required">*</span></label>
        <select id="category" formControlName="category">
          <option value="" disabled selected>Select category</option>
          <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
        </select>
        <div class="error" *ngIf="f['category'].touched && f['category'].errors">
          <span *ngIf="f['category'].errors['required']">Category is required.</span>
        </div>
      </div>

      <div class="field">
        <label for="activity">Activity<span class="required">*</span></label>
        <input id="activity" type="text" formControlName="activity" placeholder="e.g. Office commute" />
        <div class="error" *ngIf="f['activity'].touched && f['activity'].errors">
          <span *ngIf="f['activity'].errors['required']">Activity is required.</span>
          <span *ngIf="f['activity'].errors['maxlength']">Activity is too long.</span>
        </div>
      </div>

      <div class="field-inline">
        <div class="field">
          <label for="amount">Amount<span class="required">*</span></label>
          <input id="amount" type="number" formControlName="amount" min="0" step="0.01" />
          <div class="error" *ngIf="f['amount'].touched && f['amount'].errors">
            <span *ngIf="f['amount'].errors['required']">Amount is required.</span>
            <span *ngIf="f['amount'].errors['positive']">Amount must be greater than 0.</span>
          </div>
        </div>

        <div class="field">
          <label for="unit">Unit<span class="required">*</span></label>
          <select id="unit" formControlName="unit">
            <option value="" disabled selected>Select unit</option>
            <option *ngFor="let u of units" [value]="u">{{ u }}</option>
          </select>
          <div class="error" *ngIf="f['unit'].touched && f['unit'].errors">
            <span *ngIf="f['unit'].errors['required']">Unit is required.</span>
          </div>
        </div>
      </div>

      <div class="field">
        <label for="date">Date<span class="required">*</span></label>
        <input id="date" type="date" formControlName="date" />
        <div class="error" *ngIf="f['date'].touched && f['date'].errors">
          <span *ngIf="f['date'].errors['required']">Date is required.</span>
          <span *ngIf="f['date'].errors['futureDate']">Date cannot be in the future.</span>
        </div>
      </div>

      <div class="field">
        <label for="notes">Notes</label>
        <textarea id="notes" rows="3" formControlName="notes" placeholder="Optional details"></textarea>
      </div>

      <button type="submit" class="primary" [disabled]="form.invalid && submitted">
        Save emission
      </button>
    </form>

    <aside class="preview-card">
      <h2>Emission Preview</h2>
      <div class="preview-section">
        <p class="preview-value" *ngIf="previewCo2 > 0; else noPreview">
          {{ previewCo2 | number: '1.0-3' }}<span class="preview-unit">kg COâ‚‚</span>
        </p>
        <ng-template #noPreview>
          <p class="preview-placeholder">Fill in category, amount and unit to see CO2 estimate.</p>
        </ng-template>
      </div>

      <div class="preview-meta" *ngIf="form.value.category || form.value.activity || form.value.amount || form.value.date">
        <div class="meta-item" *ngIf="form.value.category">
          <span class="meta-label">Category:</span>
          <span class="meta-value">{{ form.value.category }}</span>
        </div>
        <div class="meta-item" *ngIf="form.value.activity">
          <span class="meta-label">Activity:</span>
          <span class="meta-value">{{ form.value.activity }}</span>
        </div>
        <div class="meta-item" *ngIf="form.value.amount && form.value.unit">
          <span class="meta-label">Amount:</span>
          <span class="meta-value">{{ form.value.amount }} {{ form.value.unit }}</span>
        </div>
        <div class="meta-item" *ngIf="form.value.date">
          <span class="meta-label">Date:</span>
          <span class="meta-value">{{ form.value.date | date: 'mediumDate' }}</span>
        </div>
      </div>
    </aside>
  </section>
</main>
